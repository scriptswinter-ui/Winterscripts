-- Winter's AP Spam

local v0 = getgenv and getgenv() or _G
if v0.__WINTER_AP_SPAM__ then return end
v0.__WINTER_AP_SPAM__ = true

repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

local commands = {"rocket","balloon","inverse","tiny"}

-- Find RemoteEvent
local Remote
do
    local t = os.clock()
    while os.clock() - t < 6 do
        local p = ReplicatedStorage:FindFirstChild("Packages")
        if p and p:FindFirstChild("Net") then
            Remote = p.Net:FindFirstChild("RE/AdminPanelService/ExecuteCommand")
            if Remote then break end
        end
        task.wait(0.1)
    end
end
if not Remote then return end

-- Format player name
local function formatName(plr)
    if plr.DisplayName ~= "" and plr.DisplayName ~= plr.Name then
        return plr.DisplayName.." (@"..plr.Name..")"
    end
    return "@"..plr.Name
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "WintersAPSpamGUI"
gui.ResetOnSpawn = false
gui.Parent = CoreGui

local frame = Instance.new("Frame")
frame.Size = UDim2.fromOffset(240, 300)
frame.Position = UDim2.fromOffset(60, 120)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.BorderSizePixel = 0
frame.Parent = gui

Instance.new("UICorner", frame).CornerRadius = UDim.new(0,10)
Instance.new("UIStroke", frame).Color = Color3.fromRGB(255,80,80)

-- Top bar (drag)
local top = Instance.new("Frame", frame)
top.Size = UDim2.new(1,0,0,36)
top.BackgroundColor3 = Color3.fromRGB(30,30,30)
Instance.new("UICorner", top).CornerRadius = UDim.new(0,10)

local title = Instance.new("TextLabel", top)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1,0,1,0)
title.Font = Enum.Font.GothamBold
title.TextSize = 15
title.TextColor3 = Color3.fromRGB(240,240,240)
title.Text = "Winter's AP Spam"

-- Scrolling frame for player buttons
local list = Instance.new("ScrollingFrame", frame)
list.Position = UDim2.fromOffset(6, 42)
list.Size = UDim2.new(1,-12,1,-48)
list.CanvasSize = UDim2.new()
list.ScrollBarThickness = 5
list.BackgroundTransparency = 1
list.BorderSizePixel = 0

local layout = Instance.new("UIListLayout", list)
layout.Padding = UDim.new(0,6)

-- Dragging functionality
local dragging = false
local dragStart, startPos

top.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1
    or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
    end
end)

UIS.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement
    or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        frame.Position = UDim2.fromOffset(
            startPos.X.Offset + delta.X,
            startPos.Y.Offset + delta.Y
        )
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1
    or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- Function to send commands to a selected player
local function sendToPlayer(plr)
    task.spawn(function()
        for _, cmd in ipairs(commands) do
            pcall(function()
                Remote:FireServer(plr, cmd)
            end)
        end
    end)
end

-- Function to create a player button
local function createPlayerButton(plr)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-4,0,30)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.fromRGB(235,235,235)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.TextXAlignment = Enum.TextXAlignment.Left
    btn.Text = "  "..formatName(plr)
    btn.Parent = list
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)

    btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(60,60,60) end)
    btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(40,40,40) end)

    btn.Activated:Connect(function()
        sendToPlayer(plr)
    end)
end

-- Refresh the player list
local function refreshList()
    for _,v in ipairs(list:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            createPlayerButton(plr)
        end
    end
    task.wait()
    list.CanvasSize = UDim2.fromOffset(0, layout.AbsoluteContentSize.Y + 8)
end

Players.PlayerAdded:Connect(refreshList)
Players.PlayerRemoving:Connect(refreshList)
refreshList()
