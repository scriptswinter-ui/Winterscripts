local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

pcall(function()
    CoreGui:FindFirstChild("WinterScripts"):Destroy()
end)

local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "WinterScripts"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0,160,0,160)
Frame.Position = UDim2.new(0.78,0,0.45,0)
Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0,10)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,24)
Title.Position = UDim2.new(0,0,0,4)
Title.BackgroundTransparency = 1
Title.Text = "WINTER SCRIPTS"
Title.Font = Enum.Font.Code
Title.TextSize = 15
Title.TextColor3 = Color3.new(1,1,1)

local function makeButton(text,y)
    local b = Instance.new("TextButton", Frame)
    b.Size = UDim2.new(0.9,0,0,28)
    b.Position = UDim2.new(0.05,0,0,y)
    b.BackgroundColor3 = Color3.fromRGB(15,15,15)
    b.BorderSizePixel = 0
    b.Text = text
    b.Font = Enum.Font.Code
    b.TextSize = 13
    b.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
    return b
end

local btnTP1 = makeButton("TP Base 1 [F]",30)
local btnTP2 = makeButton("TP Base 2 [G]",70)
local btnBlock = makeButton("Block Player [E]",110)

local base1_a = Vector3.new(-356.3179626464844,-7.3000030517578125,31.689111709594727)
local base1_b = Vector3.new(-346.5231628417969,-7.3000030517578125,97.14485931396484)

local base2_a = Vector3.new(-362.111572265625,-7.3000030517578125,97.56703186035156)
local base2_b = Vector3.new(-352.6886901855469,-7.3000030517578125,22.54126358032226)

local function equipCarpet()
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local bp = LocalPlayer:WaitForChild("Backpack")
    local tool = bp:FindFirstChild("Flying Carpet") or char:FindFirstChild("Flying Carpet")
    if tool then
        tool.Parent = char
        char:FindFirstChildOfClass("Humanoid"):EquipTool(tool)
    end
end

local function getClosestPlayer()
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local closest,dist=nil,math.huge
    for _,p in pairs(Players:GetPlayers()) do
        if p~=LocalPlayer and p.Character then
            local phrp=p.Character:FindFirstChild("HumanoidRootPart")
            if phrp then
                local d=(phrp.Position-hrp.Position).Magnitude
                if d<dist then
                    dist=d
                    closest=p
                end
            end
        end
    end
    return closest
end

local function openBlock(plr)
    if not plr then return end
    pcall(function()
        StarterGui:SetCore("PromptBlockPlayer", plr)
    end)
end

local function tpBase1()
    local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp=char:WaitForChild("HumanoidRootPart")
    equipCarpet()
    hrp.CFrame=CFrame.new(base1_a)
    task.wait(0.15)
    equipCarpet()
    hrp.CFrame=CFrame.new(base1_b)
    task.wait(0.15)
    equipCarpet()
    hrp.CFrame=hrp.CFrame*CFrame.new(16,0,0)
    openBlock(getClosestPlayer())
end

local function tpBase2()
    local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp=char:WaitForChild("HumanoidRootPart")
    equipCarpet()
    hrp.CFrame=CFrame.new(base2_a)
    task.wait(0.15)
    equipCarpet()
    hrp.CFrame=CFrame.new(base2_b)
    task.wait(0.15)
    equipCarpet()
    hrp.CFrame=hrp.CFrame*CFrame.new(19,0,0)
    openBlock(getClosestPlayer())
end

btnTP1.MouseButton1Click:Connect(tpBase1)
btnTP2.MouseButton1Click:Connect(tpBase2)
btnBlock.MouseButton1Click:Connect(function()
    openBlock(getClosestPlayer())
end)

UserInputService.InputBegan:Connect(function(input,gp)
    if gp then return end
    if input.KeyCode==Enum.KeyCode.F then
        tpBase1()
    elseif input.KeyCode==Enum.KeyCode.G then
        tpBase2()
    elseif input.KeyCode==Enum.KeyCode.E then
        openBlock(getClosestPlayer())
    end
end)
